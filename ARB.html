<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/3/w3.css">
<body>

<!-- Content will go here -->
  <h1>byeung0x Private Space</h1>
  
</body>
  <!-- Navigation -->
<nav class="w3-bar w3-black">
  <a href="/index.html" class="w3-button w3-bar-item">Home</a>
  <a href="#about" class="w3-button w3-bar-item">About</a>
  <a href="/python.html" class="w3-button w3-bar-item">Python Test</a>
  <a href="/FTX.html" class="w3-button w3-bar-item">Crypto Quant Zone</a>  
  <a href="/contact.html" class="w3-button w3-bar-item">Contact</a>
</nav>
    
 
    
<body>
    <h1>Get Crypto Price</h1>

    <button id="open_ws-btn" onclick="javascript:ws_open()">Get FTX price</button>

    <button id="close_ws-btn" onclick="javascript:ws_close()">Stop streaming</button>
    <table>
      <tr>
        <th>Coin</th>
        <th>Bid</th>
        <th>Ask</th>
        <th>Last updated</th>
      </tr>
      <tr>
        <td id="coin_btc">BTC/USD</td>
        <td id="bid_btc"></td>
        <td id="ask_btc"></td>
        <td id="time_btc"></td>
      </tr>
      <tr>
        <td id="coin_eth">ETH/USD</td>
        <td id="bid_eth"></td>
        <td id="ask_eth"></td>
        <td id="time_eth"></td>
      </tr>

      <tr>
        <td ></td>
        <td ></td>
        <td ></td>
        <td ></td>
      </tr>
      
      <tr>
        <td id="coin_btc_Bi">BTC/USD</td>
        <td id="bid_btc_Bi"></td>
        <td id="ask_btc_Bi"></td>
        <td id="time_btc_Bi"></td>
      </tr>
      <tr>
        <td id="coin_eth_Bi">ETH/USD</td>
        <td id="bid_eth_Bi"></td>
        <td id="ask_eth_Bi"></td>
        <td id="time_eth_Bi"></td>
      </tr><br>
      
    </table>
    


    <script>
    let ws = '';
    var book = {};
    
    function ws_open() 
      {
        if ("WebSocket" in window)
          {
            console.log("Congratulations! It supports websocket usage.");

            ws_Bi = new WebSocket("wss://stream.binance.com:9443/ws/!bookTicker");
            
            ws_Bi.onopen = function() 
              {
                console.log("Subscribing Binance BTC/USD market data...");
              };

            ws_Bi.onmessage = function (evt) 
              {
                let message = JSON.parse(evt.data);
              
                let target = message['s'];
                let b = message['b'];
                let a = message['a'];
                if (target.substring(target.length - 4).includes("BUSD") || target.substring(target.length - 4).includes("USDT"))
                  {
                    if (typeof book[target.substring(0,target.length - 4)] === 'undefined')
                      {book[target.substring(0,target.length - 4)] = {}};
                    book[target.substring(0,target.length - 4)][target] = [b,a]
                  };
                
              
                if (message['s'] == 'BTCBUSD')
                  {
                    document.getElementById('bid_btc_Bi').innerHTML = book.BTCUSDT[1] / (book.BTCBUSD[0] / book.BUSDUSDT[0]);
                    document.getElementById('ask_btc_Bi').innerHTML = book.BTCUSDT[0] / (book.BTCBUSD[1] / book.BUSDUSDT[1]);
                  }

                else if (message['s'] == 'ETHBUSD')
                  {
                    document.getElementById('bid_eth_Bi').innerHTML = b;
                    document.getElementById('ask_eth_Bi').innerHTML = a;
                  };  
              };

            ws_Bi.onclose = function() 
              {
                console.log("Connection aborbed");
              };
            
            
            
          } 
        else
          {
            console.log("Browser do not support websocket...");
          }
      };
      
   function ws_close()
     {
      ws_Bi.close();
      console.log(JSON.stringify(book));
     };

    </script>
  
  
  

</body>
</html>
