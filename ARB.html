<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/3/w3.css">
<body>

<!-- Content will go here -->
  <h1>byeung0x Private Space</h1>
  
</body>
  <!-- Navigation -->
<nav class="w3-bar w3-black">
  <a href="/index.html" class="w3-button w3-bar-item">Home</a>
  <a href="#about" class="w3-button w3-bar-item">About</a>
  <a href="/python.html" class="w3-button w3-bar-item">Python Test</a>
  <a href="/FTX.html" class="w3-button w3-bar-item">Crypto Quant Zone</a>  
  <a href="/contact.html" class="w3-button w3-bar-item">Contact</a>
</nav>
    
 
    
<body>
    <h1>Get Crypto Price</h1>

    <button id="open_ws-btn" onclick="javascript:ws_open()">Get FTX price</button>

    <button id="close_ws-btn" onclick="javascript:ws_close()">Stop streaming</button>
    <table id="CoinList">
      <tr>
        <th>Coin</th>
        <th>Bid</th>
        <th>Ask</th>
        <th>Last updated</th>
      </tr>
    </table>
    


<script>
let ws = '';
var book = {};
const table = document.getElementById("CoinList");

function ws_open() 
  {
    if ("WebSocket" in window)
      {
        console.log("Congratulations! It supports websocket usage.");

        ws_Bi = new WebSocket("wss://stream.binance.com:9443/ws/!bookTicker");

        ws_Bi.onopen = function() 
          {
            console.log("Subscribing Binance market data...");
          };


        ws_Bi.onmessage = function (evt) 
          {
            let message = JSON.parse(evt.data);


            let target = message['s'];
            let coin = target.substring(0,target.length - 4);
            let b = message['b'];
            let a = message['a'];

            if (target.substring(target.length - 4).includes("BUSD") || target.substring(target.length - 4).includes("USDT"))
              {

                if (typeof book[coin] === 'undefined')
                  {
                    book[coin] = {}
                  };

                book[coin][target] = [b,a];

                    if (typeof book[coin][coin + "BUSD"] != 'undefined' && typeof book[coin][coin + "USDT"] != 'undefined')
                      {
                        if (typeof document.getElementById("id", "LBUSD_" + coin) === 'undefined')
                          {
                            let row = table.insertRow(table.rows.length);
                            let cell1 = row.insertCell(0);
                            cell1.setAttribute("id", "coin_" + coin);
                            cell1.innerHTML = coin;
                            let cell2  = row.insertCell(1);
                            cell2.setAttribute("id", "LBUSD_" + coin);
                            let cell3 = row.insertCell(2);
                            cell3.setAttribute("id", "LUSDT_" + coin);
                            let cell4 = row.insertCell(3);
                            cell4.setAttribute("id", "t_" + coin)
                          }
                        else
                          { 
                            document.getElementById("id", "LBUSD_" + coin).innerHTML = Number(book[coin][coin + "USDT"][0]) / (Number(book[coin][coin + "BUSD"][1]) / Number(book.BUSD.BUSDUSDT[1])); 
                            document.getElementById("id", "LUSDT_" + coin).innerHTML = Number(book[coin][coin + "USDT"][1]) / (Number(book[coin][coin + "BUSD"][0]) / Number(book.BUSD.BUSDUSDT[0]))
                          }
                      }     
               }
          };

        ws_Bi.onclose = function() 
          {
            console.log("Connection aborbed");
            console.log(JSON.stringify(book));
          };
      } 
    else
      {
        console.log("Browser do not support websocket...");
      }
  };

function ws_close()
 {
  ws_Bi.close();
 };

  
</script>
  
  
  

</body>
</html>
